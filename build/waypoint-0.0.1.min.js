(function(d,e,h,f){function j(){this._ignore=f;this._debug=!1}j.prototype={resume:function(a){this.history();var b=this.target(),g=this.latest(),c=this.route();if(b){this.target(f);if(b!==c)return this._debug&&console.log("Waypoint.resume(): bad link -- target ("+b+") does not match route ("+c+"), redirecting..."),this.redirect(),this;this._debug&&console.log("Waypoint.resume(): good link -- arrived at target("+b+"), bookmarking...");this.bookmark()}else if(g&&c!==g)return this._debug&&console.log("Waypoint.resume(): bad route -- route("+
c+") does not match latest ("+g+"), redirecting..."),this.redirect(),this;this._debug&&console.log("Waypoint.resume(): good route -- arrived at route("+c+"), triggering callback...");a&&a();return this},debug:function(a){if(0===arguments.length)return this._debug;this._debug=a;return this},clear:function(){localStorage.removeItem("Waypoint.history");localStorage.removeItem("Waypoint.target");return this},bookmark:function(){var a=this.route();this._debug&&console.log("Waypoint.bookmark(): bookmarking",
a);this.push(a);return this},push:function(a){var b=this.history();b.push(a);5<b.length&&b.shift();this.history(b);return this},history:function(a){if(0===arguments.length){var b=localStorage.getItem("Waypoint.history");return JSON.parse(b)||[]}if(a)return localStorage.setItem("Waypoint.history",JSON.stringify(a)),this;localStorage.removeItem("Waypoint.history");return this},target:function(a){if(0===arguments.length){var b=localStorage.getItem("Waypoint.target");return JSON.parse(b)}if(a)return localStorage.setItem("Waypoint.target",
JSON.stringify(a)),this;localStorage.removeItem("Waypoint.target");return this},ignore:function(a){if(0===arguments.length)return this._ignore;this._ignore=a;return this},route:function(a){if(0===arguments.length)return e.location.href;e.location=a;return this},redirect:function(){var a=this.latest();a&&this.route(a);return this},back:function(){var a=this.history();1<a.length&&(a.pop(),this.history(a),this.redirect());return this},navigate:function(a){var b=h.createElement("a");b.href=a;a=b.href;
this._debug&&console.log("Waypoint.navigate(): navigating to",a);this.target(a);this.route(a);return this},latest:function(){var a=this.history();return a.length?a[a.length-1]:f},intercept:function(a){var b=this;d(h).on("click",a,function(a){return b._onClick(a.target)});return this},_onClick:function(a){if(d(a).is(this._ignore))return!0;a=d(a).attr("href");this.navigate(a);return!1}};e.Waypoint=new j})(window.jQuery||window.Zepto,window,document);
